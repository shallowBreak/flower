<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/css.css">
    <link rel="stylesheet" href="css/recal.css">
</head>
<body>
    <!-- 导航部分 -->
    <nav>
        <div class="navline clearfix">
            <ul class="leftnav clearfix">
                <li>
                    <a href="#">
                        <span class="flo1 fl1"></span>
                        收藏鲜花网(hua.com) 
                    </a>
                </li>
                <li class="flo4">
                    <a href="#">
                        <span class="flo1 fl2"></span>
                        关注微信
                        <span class="line"></span>
                    </a>
                    <div class="flo3">
                        <img src="https://img02.hua.com/pc/pimg/wechat_qrcode.jpg" alt="">
                        <p>扫码关注
                        <br>回复“礼物”更多惊喜</p>
                    </div>
                </li>
                <li class="flo4">
                    <a href="#">
                        <span class="flo1 fl3"></span>
                        花礼网app
                        <span class="line"></span>
                    </a>
                    <div class="flo3">
                        <img class="flo3tu"  src="https://img02.hua.com/pc/pimg/app_qrcode.jpg" alt="">
                        <p>新人专享100元App礼包</p>
                    </div>
                </li>
            </ul>
            <ul class="rightnav">
                <li>
                    <a href="login.html">
                        您好，请登录
                    </a>
                    <a href="register.html">
                        注册
                    </a>
                </li>
                <span class="line1"></span>
                <li>
                    <a href="#">
                        订单查询
                    </a>   
                </li>
                <span class="line1"></span>
                <li  class="rightnav1">
                    <a href="#">
                        我的花礼
                    </a>
                </li>
                <span class="line1"></span>
                <li class="rightnav2">
                    <a href="#">
                        客户服务
                        <span></span>
                    </a>
                    <div>
                        <a href="#">在线付款</a>
                        <a href="#">帮助中心</a>
                        <a href="#">售后服务</a>
                        <a href="#">配送范围</a>
                        <a href="#">留言反馈</a>
                    </div>
                </li>
                <span class="line1"></span>
                <li class="rightnav3">
                    <a href="#">
                        <span class="car"></span>
                        购物车
                        <span class="zero">(0)</span>
                        <span class="car2"></span>
                    </a>
                </li>
                <span class="line1"></span>
                <li>
                    <p>
                        中国鲜花礼品网：中国鲜花网领先品牌
                    </p>
                </li>
            </ul>
        </div>
    </nav>
    <!-- 搜索 -->
    <section>
        <div class="searchleft">
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/logo.png" alt="">
            </a>
            <span></span>
            <div class="cfl">
                <img src="image/tu4.png" alt="">
            </div>   
        </div>
        <div class="search">
            <div class="searchr clearfix">
                <input type="text" name="" id="" placeholder="商品关键词">
                <button>搜索</button>
            </div>
            <p class="tit">
                <a href="#">红玫瑰</a>
                <span>|</span>
                <a href="#">永生花</a>
                <span>|</span>
                <a href="#">生日鲜花</a>
                <span>|</span>
                <a href="#">礼品卡</a>
            </p>
        </div>
        <div class="searchright">
            <p>
                <span class="search1 "></span>
                <em> 400-889-8188</em>
            </p>
            <span>|</span>       
            <a href="#">
                <span></span>
                <em>在线客服</em>
            </a>
        </div>
    </section>
    <!-- 第二个导航条 -->
    <aside class="clearfix">
        <div class="navv clearfix">
            <div class="navvleft" id="navvleft">
                <a href="#" class="shop">全部商品导购</a>
                <div class="shopleft" >
                    <h4>鲜花用途</h4>
                    <ul class="shoptop">
                        <a href="#">爱情鲜花</a>
                        <a href="#">生日鲜花</a>
                        <a href="#">友情鲜花</a>
                        <a href="#">问候长辈</a>
                        <a href="#">探病慰问</a>
                        <a href="#">道歉鲜花</a>
                        <a href="#">祝贺鲜花</a>
                        <a href="#">婚庆鲜花</a>
                        <a href="#">商务鲜花</a>
                    </ul>
                    <h4>鲜花花材</h4>
                    <ul class="shopbottom">
                        <a href="#">玫瑰</a>
                        <a href="#">康乃馨</a>
                        <a href="#">郁金香</a>
                        <a href="#">百合</a>
                        <a href="#">扶郎</a>
                        <a href="#">马蹄莲</a>
                        <a href="#">向日葵</a>
                    </ul>
                    <h4>鲜花类别</h4>
                    <ul class="shopbottom">
                        <a href="#">花束</a>
                        <a href="#">花盒</a>
                        <a href="#">瓶花</a>
                        <a href="#">精品鲜花</a>
                        <a href="#">果篮</a>
                        <a href="#">桌面花篮</a>
                        <a href="#">开业花篮</a>
                    </ul>
                    <div class="sceond clearfix">
                        <h4>永生花<span class="boo1"></span></h4>
                        <ul class="shopbottom1">
                            <a href="#">经典花盒</a>
                            <a href="#">巨型玫瑰</a>
                            <a href="#">薰衣草</a>              
                        </ul>  
                    </div>
                    <div class="sceond clearfix">
                        <h4 class="clearfix cake">蛋糕<span class="boo1"></span></h4>
                        <ul class="shopbottom2">
                            <a href="#">元祖</a>
                            <a href="#">更多</a>
                        </ul>
                    </div>
                    <div class="sceond clearfix">
                        <h4 class="cake h4last">
                            <a href="#">礼品</a>/
                            <a href="#">公仔</a>/
                            <a href="#"> 绿植</a>
                            <span class="boo1"></span>
                        </h4>  
                    </div> 
                </div>
            </div>
            <ul class="clearfix">
                <li><a href="#">鲜花</a></li>
                <li><a href="#">永生花</a></li>
                <li><a href="#">蛋糕</a></li>
                <li><a href="#">礼品</a></li>
                <li><a href="#">巧克力</a></li>
                <li><a href="#">花语大全</a></li>
                <li><a href="#">企业团购</a></li>
                <li><a href="#">设计师臻选鲜花</a></li>
                <li><a href="#" class="lilast">重阳节鲜花</a></li>
            </ul>
        </div>  
    </aside>
    <!-- 中间部分 -->
    <div class="center"  id="wrap">
        <!-- <div class="center1 clearfix">
            <div class="imgs" id="small">
                    <div id="frame">
                    一个框
                    </div>
                <img src="https://img01.hua.com/uploadpic/newpic/9010947.jpg" alt="">
            </div>
            <div id="big">
                <img src="images/timg.jpg" alt="">
            </div>
            <div class="titit">
                <p class="t1">真爱如初--雪山玫瑰11枝、深紫色勿忘我0.3扎</p>
                <a href="#">热卖单品，惊艳之选！</a>
                <p class="t2">类 别：鲜花-鲜花礼盒 编 号：9010947</p>
                <p class="t2">材 料：高档礼盒装鲜花:雪山玫瑰11枝、深紫色勿忘我0.3扎</p>
                <p class="t2">包 装：素染纸-浅灰2张，雪梨纸0.5张，银灰色logo缎带1米，魔力铁山灰盒(小)</p>
                <p class="t2">花语：用一袭白裙装扮你那无瑕的身姿，向一抹白云倾诉对你的思念，用一捧鲜花证明我不变的心。</p>
            </div>
        </div> -->
    </div>
    <!-- 尾部效果 -->
    <div class="lastbot">
        <div class="lastbot1 clearfix">
            <div class="fo1">
                <h4 class="fo00">客户服务</h4>
                <a href="#">服务声明</a>
                <a href="#">支付说明</a>
                <a href="#">境外支付</a>
                <a href="#">配送说明</a>
                <a href="#">配送范围</a>
                <a href="#">订单查询</a>
                <a href="#">取消订单</a>
                <a href="#">补交货款</a>
                <a href="#">隐私条款</a>
                <a href="#">安全条款</a>
            </div>
            <div class="fo2">
                <h4 class="fo00">热门资讯</h4>
                <a href="#">中国鲜花礼品网购物流程</a>
                <a href="#">中国鲜花礼品网订购演示</a>
                <a href="#">鲜花网能配送哪些城市？</a>
                <a href="#">鲜花售后服务是怎么样的？</a>
                <a href="#">我应该提前多久预定鲜花</a>
            </div>
            <div class="fo3 fo1">
                <h4 class="fo00"><a href="#">同城鲜花专区</a></h4>
                <a href="#" class="fo33">深圳鲜花</a>
                <a href="#" class="fo33">北京鲜花</a>
                <a href="#" class="fo33">上海鲜花</a>
                <a href="#" class="fo33">广州鲜花</a>
                <a href="#" class="fo33">天津鲜花</a>
                <a href="#" class="fo33">重庆鲜花</a>
                <a href="#" class="fo33">成都鲜花</a>
                <a href="#" class="fo33">西安鲜花</a>
                <a href="#" class="fo33">武汉鲜花</a>
                <a href="#" class="fo33">南京鲜花</a>
                <a href="#" class="fo33">厦门鲜花</a>
                <a href="#" class="fo33">更多城市</a>
            </div>
            <div class="fo4">
                <h4 class="fo00">联系我们</h4>
                <p>全国订购热线：400-889-8188(免长途费)</p>
                <a href="#">在线客服</a>
                <p>7*24小时在线订购</p>
                <p>客服工作时间：8:30-21:00</p>
                <p>E-mail:kefu@hua.com</p>
            </div>
        </div>
    </div>
    <div class="llast">
        <div class="logo">
            <a href="#">
                <img class="logo2" src="https://img02.hua.com/pc/assets/img/cxwz.png" alt="">
            </a>
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/cxwz.gif" alt="">
            </a>
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/smyz.gif" alt="">
            </a>
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/slogan.png" alt="">
            </a>
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/zfb.gif" alt="">
            </a>
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/100.jpg" alt="">
            </a>
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/bico1.jpg" alt="">
            </a>
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/bico4.jpg" alt="">
            </a>
            <a href="#">
                <img src="https://img02.hua.com/pc/assets/img/bico3.jpg" alt="">
            </a>
        </div>
    </div>
    <p class="lllast">
        <a href="#">中国电子商务会员</a>
        <span>ICP营业许可证：</span>
        <a href="#">粤B2-20050744</a>
        <span>|</span>
        <a href="#">粤ICP备09171662号</a>
        <span>粤公网安备44030502000373号 Copyright&copy; 2005-2018</span>
        <br>
        <span>花礼网(中国鲜花礼品网)</span>
        <a href="#">www.hua.com</a>
        <span>深圳市百易信息技术有限公司 中国鲜花网领先品牌，鲜花速递专家！</span>
    </p>   
    <div class="friend">
        <p>
            <span>友链</span>
            <a href="#">中华取名网</a>
            <a href="#">深圳房产网</a>
            <a href="#">卷皮网</a>
            <a href="#">腕表</a>
            <a href="#">宝贝团婚网</a>
            <a href="#">苗木</a>
            <a href="#">佐伊卡珠宝</a>
            <a href="#">钻石婚戒定制</a>
            <a href="#">杂志</a>
            <a href="#">中国青少年艺术教育网</a>
            <a href="#">装修网</a>
            <a href="#">淘狗网</a>
            <a href="#">礼无忧网</a>
            <a href="#">宠物狗</a>
            <a href="#">机友网</a>
            <a href="#">礼物网</a>
            <a href="#">装修</a>
            <a href="#">新三版</a>
            <a href="#">商标注册</a>
            <a href="#">眼睛店</a>
            
        </p>
    </div>
    <div class="shp">
        <span class="sh1"></span>
        <span id="sp">0</span>
        <button id="obtn">
            购物车
        </button>
       <div class="container">
            <ul>

            </ul>
       </div> 
    </div>
    <script src="script/jquery.js"></script>
    <script>
        function WaterFall(){}
        $.extend(WaterFall.prototype,{
            init:function(){
                // 页数;
                this.page = 1;
                // 结构外包围;
                this.main = $("#wrap");
                // 是否在加载中;
                this.loading = false;

                this.loadJson()
                .done(function(res){
                    // deferred 的 done 回调 this指向的都是 jquery 对象本身
                    // console.log(res,this);
                    this.renderPage(res);
                })

                this.bindEvent();
            },
            loadJson:function(){
                var opt = {
                    // 链接接口
                    url:"http://www.wookmark.com/api/json/popular",
                    // 预期服务器返回的数据类型
                    dataType:"jsonp",
                    // 发送到服务器的数据。将自动转换为请求字符串格式
                    data:{page:this.page},
                    // this => 指向实例化对象;
                    //检测上下文
                    context:this
                }
                // ajax() 方法通过 HTTP 请求加载远程数据
                return $.ajax(opt);
            },
            //此函数为回掉函数
            renderPage:function(json){
                // console.log(json);
                var html = "";
                for(var i = 0 ; i < json.length ; i ++){

                    var height = json[i].height / (json[i].width / 220);

                    if(isNaN(height)) continue; 
                    html += `<div class="center1 clearfix">
                                <div class="imgs">
                                    <img src="${json[i].image}" data-id="${i}" alt="">
                                </div>
                                <div class="titit">
                                    <p class="t1">真爱如初--雪山玫瑰11枝、深紫色勿忘我0.3扎</p>
                                    <a href="#">热卖单品，惊艳之选！</a>
                                    <p class="t2">类 别：鲜花-鲜花礼盒 编 号：9010947</p>
                                    <p class="t2">材 料：高档礼盒装鲜花:雪山玫瑰11枝、深紫色勿忘我0.3扎</p>
                                    <p class="t2">包 装：素染纸-浅灰2张，雪梨纸0.5张，银灰色logo缎带1米，魔力铁山灰盒(小)</p>
                                    <p class="t2">花语：用一袭白裙装扮你那无瑕的身姿，向一抹白云倾诉对你的思念，用一捧鲜花证明我不变的心。</p>
                                    <button id="btn"><span></span>加入购物车</button>
                                </div>
                            </div>`
                }
                this.main.html(this.main.html() + html);
                this.loading = false;
            },

            bindEvent(){
                $(window).on("scroll",this.ifLoad.bind(this));
                console.log(this)
            },
            ifLoad(){
                // console.log(1);
                // scrollTop ;
                // 最后一张图片;
                // 当前屏幕的高度;
                console.log(this.ifLoad)
                var scrollTop = $("html,body").scrollTop();
                var clientHeight = $("html")[0].clientHeight;
                var lastBox = this.main.children(":last");
                // console.log(scrollTop,clientHeight,lastBox.offset());
                if(scrollTop + clientHeight > lastBox.offset().top){
                    // 加载数据;
                    if(this.loading){
                        return 0;
                    }
                    this.loading = true;
                    // console.log("加载");
                    this.page ++;
                    this.loadJson()
                    .done(function(res){
                        // deferred 的 done 回调 this指向的都是 jquery 对象本身
                        // console.log(res,this);
                        this.renderPage(res);
                    })
                }
            }
        })

        var waterfall = new WaterFall();
        waterfall.init();
        
    </script>
    <script src="script/common.js"></script>
    <script>
        var oList = document.getElementById("wrap");
       // 委托;
       
       oList.onclick = function(evt){
           var e = evt || window.event;
           var img = document.querySelectorAll("#wrap img");
           var imgArray = Array.from(img);
           var target = e.target || e.srcElement;
        //    console.log(imgArray);   
            if(imgArray.indexOf(target) != -1){
                // 页面跳转;
                // 先要储存cookie;
                cookie("goodsId",target.getAttribute("data-id"));
                location.href = "detail.html";
            }
       }
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="script/jquery.cookie.js"></script>
    <script src=""></script>
    <script>
       function ShopCar(){

        }
        $.extend(ShopCar.prototype,{
            init:function(){
                this.main = $(".container ul")
                this.loadJson()
                .then(function(res){
                    // console.log(res);
                    // this.json = res.subjects;
                    console.log(res)
                    
                })
                this.bindEvent();
                this.listSum();
            },
            loadJson:function(){
                var opt = {
                    url:"http://www.wookmark.com/api/json/popular",
                    data:{page:this.page},
                    dataType:"jsonp",
                    type:"GET",
                    context : this
                }
                return $.ajax(opt);
            },
            bindEvent:function(){
                $(".container ul").on("click","button",this.addCar.bind(this));

                $(".shopCar>div").on("mouseenter",this.showList.bind(this));
                $(".shopCar>div").on("mouseleave",function(){
                    $(".goods-list").children().remove();
                });
                $(".shopCar>div").on("click",function(event){
                    var target = event.target ; 
                    if(target != $(".shopCar>div")[0]) return 0;

                    $.removeCookie("shopCar");
                    // 执行鼠标移出事件;
                    $(".shopCar>div").triggerHandler("mouseleave");
                    this.listSum();
                }.bind(this));
            },
            addCar:function(event){
                // 我怎么知道把谁加入到购物车之中那?;
                var target = event.target ;
                var goodsId = $(target).attr("data-id");
                // console.log(goodsId);
                // 如何把id加入cookie;
                // $.cookie("shopCar",goodsId);

                // cookie 是纯文本;          JSON.parse()  string => array;
                // 加入购物车需要 array 数组; JSON.stringify()  array  => string;
                
                // $.cookie("shopCar",`[${goodsId}]`);
                // console.log($.cookie("shopCar"));

                // 分成两种情况;
                // 1. cookie之中没有 shopCar cookie 或者 shopCarcookie里面的值为空数组;

                // 建立数组结构;

                // 2. cookie 之中有了shopCar cookie shopCarCookie里面的数组不为空;

                // 把cookie转换成数组 进行push操作 ;  转换成字符串 放入cookie之中;
                var cookie;
                if((cookie = $.cookie("shopCar"))){
                    // 将字符串转换为数组, 方便插入操作;
                    // console.log(cookie);
                    var cookieArray = JSON.parse(cookie);
                    // 判定当前要添加的商品 是否已经存在在购物车里;
                    // 表示是否存在商品;
                    var hasGoods = false;
                    for(var i = 0 ; i < cookieArray.length ; i ++){
                        if(cookieArray[i].id == goodsId ) {
                            // 存在 商品;
                            hasGoods = true;
                            cookieArray[i].num ++;
                            break;
                        }
                    }
                    // 如果没有商品;
                    if(hasGoods == false){
                        var goods = {
                            id : goodsId,
                            num : "1"
                        }
                        cookieArray.push(goods);
                    }

                    // 将数组 转为字符串 方便 储存cookie;

                    // console.log(JSON.stringify(cookieArray));
                    $.cookie("shopCar",JSON.stringify(cookieArray));
                }else{
                    $.cookie("shopCar",`[{"id":"${goodsId}","num":"1"}]`);
                }
                console.log($.cookie("shopCar"));
                this.listSum();
            }
            ,
            showList:function(event){
                // 判定是否存在购物车,如果不存在购物车就没必要拼接列表了;
                var target = event.target;

                if(target != $(".shopCar>div")[0]) return 0;

                var cookie;
                if(!(cookie = $.cookie("shopCar"))){ return 0; };
                var cookieArray = JSON.parse(cookie);

                var html = "";
                // for 购物车里有多少商品就拼接多少个;
                for(var i = 0 ; i < cookieArray.length ; i ++){
                    // console.log(cookieArray[i]);
                    // for 判断哪一个商品是购物车里的商品;
                    for(var j = 0 ; j < this.json.length ; j ++){
                        if(cookieArray[i].id == this.json[j].id){
                            html += `<li data-id="${cookieArray[i].id}">
                                        <img src="${this.json[j].images.small}" alt="">
                                        <h3>花语：一生一世的情缘</h3>
                                    </li>`;
                            break;
                        }
                    }
                }
                
                $(".goods-list").html(html);
            },
            listSum:function(){
                var cookie;
                if(!(cookie = $.cookie("shopCar"))){ 
                    $(".shopCar").find("span").html(0);
                    return 0;
                };
                var cookieArray = JSON.parse(cookie);
                var sum = 0;
                for(var i = 0 ; i < cookieArray.length ; i ++){
                    sum += Number(cookieArray[i].num);
                }
                $(".shopCar").find("span").html(sum);
            }

        })

        var car = new ShopCar();
        car.init(); 
    </script>
</body>
</html>